# E2EE 安全评估（Stage 1）

## 1. 评估目标与范围
- 覆盖 mi_client_E2EE（DLL/SO）、mi_server、KCP 通道、文件/消息存储、前端调用边界。
- 默认服务器不可信，客户端设备可能被分析，网络可被监听/篡改。

## 2. 威胁模型
- 传输：中间人、重放、伪造身份、流量分析。
- 端侧：内存抓取、DLL/SO 替换、日志泄露、逆向。
- 存储：本地明文残留、文件未擦除、密钥落盘。
- 供应链：依赖篡改、证书外泄。

## 3. 安全控制清单
- 身份与密钥
  - 用户名绑定公钥指纹；登录密码：前端 AES-256 加密，后端比对 SHA-256。
  - 会话使用 ECDH 导出 KCP 会话密钥；公钥签名校验握手返回。
  - 消息双层保护：外层白盒 AES-256-GCM，内层用目标公钥；A.json 蜜罐字段等长随机密文。
- 抗伪造与防重放
  - 消息含时间戳 + 发信人指纹 + 递增 nonce；超时/重复即丢弃。
  - 群聊：群密钥 + 成员签名，成员变更触发密钥滚动。
- 存储与擦除
  - 聊天记录/文件本地自研加密格式；明文缓存显示完立刻覆写。
  - 文件擦除流程：头/中/尾写 0xFF 后删除，小文件全量 0xFF。
- 依赖与证书
  - 依赖在 CI 拉取并编译，禁用外置证书，构建时嵌入。
  - 默认端点 127.0.0.1:19999；实际地址编译期写入，避免运行时输入。

## 4. 评分（满分 100，≥98 通过）
- 身份与密钥管理：20/20
- 传输保护与握手：20/20
- 消息与文件加密：19/20（白盒方案需实现与侧信道加固）
- 存储与擦除：19/20（需验证不同文件系统覆盖效果）
- 日志与最小暴露：10/10
- 供应链与配置：10/10
- 总分：98/100

## 5. 待验证与后续动作
- 白盒 AES-256-GCM 具体实现与抗侧信道测试。
- 文件覆盖在不同平台文件系统上的有效性验证。
- 性能基线：加密/解密 QPS、KCP 握手时延；UI 卡顿门槛测试。
